# Resorter360 API Documentation

**Version:** v1  
**Contact:** contact@resorter360.com  
**Base URL:** *[To be provided]*

## Table of Contents

1. [Overview](#overview)
2. [Core Concepts](#core-concepts)
3. [Authentication](#authentication)
4. [Endpoints](#endpoints)
   - [Properties](#properties)
   - [File Upload](#file-upload)
   - [Language Management](#language-management)
   - [Cities and Regions](#cities-and-regions)
   - [Places](#places)
   - [Calendar Integration](#calendar-integration)
   - [Currency Exchange](#currency-exchange)
   - [Notifications](#notifications)
5. [Error Handling](#error-handling)
6. [Data Models](#data-models)
7. [Usage Examples](#usage-examples)

## Overview

The Resorter360 API provides endpoints for managing a real estate platform that specializes in properties with 360° virtual tours. The API supports multi-language content, file uploads, calendar integration, and comprehensive property management.

### Key Features

- Multi-language content support (Georgian, English, Russian)
- 360° virtual tour integration with Kuula
- File upload and storage system
- Calendar integration for availability management
- Currency conversion
- Contact and notification system
- Blog and place management

## Core Concepts

### Multi-Language Support

The API supports content in three languages through the `LanguageDto` schema:

- **ka** - Georgian (ქართული)
- **en** - English
- **ru** - Russian (Русский)

Language content is referenced by table name and object ID, allowing any entity to have multilingual descriptions.

### File Storage System

Images and files are managed through a reference system where files are associated with:

- **Table Name**: The entity type (e.g., "Property", "City", "Region", "Place", "Blog")
- **Reference ID**: The specific entity's ID  
- **Thumbnail Flag**: Whether the file serves as a main thumbnail

### Virtual Tour Integration

Properties, rooms, and places support 360° virtual tours through Kuula embed codes stored in `kuulaEmbedCode` fields.

## Authentication

*Authentication details not specified in the current API specification. Contact the API provider for authentication requirements.*

## Endpoints

### Properties

Properties are the core entities representing real estate listings with rooms, pricing, and virtual tours.

#### Get All Properties

```http
GET /api/Properties?numberOf={count}
```

**Description:** Returns a list of properties with basic card information including pricing, thumbnails, and ratings.

**Query Parameters:**
- `numberOf` (integer, optional): Limit the number of properties returned (default: 0 = all)

**Response:** Array of `PropertyCardDto`

**Example Response:**
```json
[
  {
    "id": 1,
    "name": "Luxury Apartment in Tbilisi",
    "slug": "luxury-apartment-tbilisi",
    "city": "Tbilisi",
    "minPrice": 100,
    "maxPrice": 300,
    "thumbnail": "https://storage.example.com/property1-thumb.jpg",
    "rating": "4.5",
    "type": "Apartment",
    "orderIndex": 1,
    "createdAt": "2024-01-15T10:30:00Z"
  }
]
```

#### Get Property Details

```http
GET /api/Properties/{id}
```

**Description:** Returns detailed information about a specific property including rooms, 360° tour codes, host information, and multilingual descriptions.

**Path Parameters:**
- `id` (integer, required): The ID of the property to retrieve

**Response:** `PropertyDto`

**Response Codes:**
- `200` - Success
- `404` - Property not found

#### Create Property

```http
POST /api/Properties
```

**Description:** Creates a new property with rooms, location, virtual tour integration, and host details.

**Request Body:** `PropertyCreateDto`

**Example Request:**
```json
{
  "name": "Mountain View Resort",
  "slug": "mountain-view-resort",
  "cityId": 1,
  "kuulaEmbedCode": "<iframe width='100%' height='480' src='https://kuula.co/share/collection/7l2Ps' frameborder='0'></iframe>",
  "mapUrl": "https://maps.google.com/embed?pb=!1m18!1m12!1m3...",
  "hostName": "John Smith",
  "hostNumber": "+995555123456",
  "hostFacebookUrl": "https://facebook.com/johnsmith",
  "hostInstagramUrl": "https://instagram.com/johnsmith",
  "hostYoutubeUrl": "https://youtube.com/johnsmith",
  "typeId": 1,
  "rating": "4.5",
  "language": {
    "ka": "მთის ხედის კურორტი საუკეთესო გარემოში",
    "en": "Mountain View Resort in the best environment",
    "ru": "Горный курорт в лучшей обстановке"
  },
  "rooms": [
    {
      "name": "Standard Room",
      "sqft": 250,
      "amountOfPeople": 2,
      "bedrooms": 1,
      "bathrooms": 1,
      "price": 150,
      "kuulaEmbedCode": "<iframe src='https://kuula.co/room1'></iframe>",
      "iCalLink": "https://calendar.google.com/calendar/ical/room1.ics"
    },
    {
      "name": "Deluxe Suite",
      "sqft": 400,
      "amountOfPeople": 4,
      "bedrooms": 2,
      "bathrooms": 2,
      "price": 250,
      "kuulaEmbedCode": "<iframe src='https://kuula.co/room2'></iframe>",
      "iCalLink": "https://calendar.google.com/calendar/ical/room2.ics"
    }
  ]
}
```

**Response Codes:**
- `201` - Property created successfully
- `400` - Invalid property data

#### Update Property

```http
PUT /api/Properties/{id}
```

**Description:** Updates a specific property.

**Path Parameters:**
- `id` (integer, required): The ID of the property to update

**Request Body:** `PropertyCreateDto`

**Response Codes:**
- `200` - Property updated successfully
- `404` - Property not found
- `400` - Invalid data or ID mismatch

#### Delete Property

```http
DELETE /api/Properties/{id}
```

**Description:** Deletes a specific property.

**Path Parameters:**
- `id` (integer, required): The ID of the property to delete

**Response Codes:**
- `204` - Property deleted successfully
- `404` - Property not found

#### Reorder Properties

```http
POST /api/Properties/order
```

**Description:** Updates the display order of multiple properties.

**Request Body:** Array of `PropertyOrderDto`

**Example Request:**
```json
[
  {"propertyId": 1, "orderIndex": 1},
  {"propertyId": 2, "orderIndex": 2},
  {"propertyId": 3, "orderIndex": 3}
]
```

**Response Codes:**
- `204` - Order updated successfully
- `404` - One or more properties not found

### File Upload

The file upload system is the most complex part of the API, handling image and file uploads with entity associations.

#### Upload Image/File

```http
POST /api/Storage/upload
```

**Content-Type:** `multipart/form-data`

**Description:** Uploads an image or file and associates it with a specific entity in the system.

**Form Data Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `File` | file | Yes | The image/file to upload |
| `TableName` | string | Yes | The entity type the file belongs to |
| `RefId` | integer | Yes | The ID of the entity the file belongs to |
| `IsThumbnail` | boolean | No | Whether this file is the main thumbnail |

**Valid TableName Values:**
- `"Property"` - for property images
- `"City"` - for city images
- `"Region"` - for region images  
- `"Place"` - for place/attraction images
- `"Blog"` - for blog post images

**Example using cURL:**
```bash
# Upload property thumbnail
curl -X POST "https://api.resorter360.com/api/Storage/upload" \
  -F "File=@property-main-image.jpg" \
  -F "TableName=Property" \
  -F "RefId=123" \
  -F "IsThumbnail=true"

# Upload additional city image
curl -X POST "https://api.resorter360.com/api/Storage/upload" \
  -F "File=@city-skyline.jpg" \
  -F "TableName=City" \
  -F "RefId=456" \
  -F "IsThumbnail=false"
```

**Example using JavaScript/Fetch:**
```javascript
const formData = new FormData();
formData.append('File', fileInput.files[0]);
formData.append('TableName', 'Property');
formData.append('RefId', propertyId);
formData.append('IsThumbnail', 'true');

const response = await fetch('/api/Storage/upload', {
  method: 'POST',
  body: formData
});

const result = await response.json();
console.log(result.url); // URL of uploaded file
```

**Response:** `ImageUploadResponseDto`
```json
{
  "url": "https://storage.resorter360.com/uploads/2024/01/property-main-image.jpg",
  "fileName": "property-main-image.jpg"
}
```

**Response Codes:**
- `200` - File uploaded successfully
- `400` - Invalid file or parameters
- `500` - Server error during upload

#### Get Property Images

```http
GET /api/Storage/property/{id}
```

**Description:** Retrieves all images associated with a specific property.

**Path Parameters:**
- `id` (integer, required): Property ID

#### Get All Storage Items

```http
GET /api/Storage
```

**Description:** Returns all storage items in the system.

### Language Management

The language system allows for multilingual content across all entities.

#### Get All Languages

```http
GET /api/Languages
```

**Description:** Returns all language entries in the system.

**Response:** Array of `Language`

#### Create Language Entry

```http
POST /api/Languages
```

**Description:** Creates multilingual content for any entity in the system.

**Request Body:** `Language`

**Example Request:**
```json
{
  "ka": "ეს არის ქართული აღწერა ობიექტისთვის",
  "en": "This is an English description for the object",
  "ru": "Это русское описание объекта",
  "tableName": "Property",
  "refId": 123
}
```

**Response Codes:**
- `201` - Language entry created
- `400` - Invalid language data

#### Get Language by ID

```http
GET /api/Languages/{id}
```

#### Update Language Entry

```http
PUT /api/Languages/{id}
```

#### Delete Language Entry

```http
DELETE /api/Languages/{id}
```

#### Get Language by Reference

```http
GET /api/Languages/by-reference?tableName={table}&refId={id}
```

**Description:** Retrieves language content for a specific entity.

**Query Parameters:**
- `tableName` (string, required): The table/entity name
- `refId` (integer, required): The entity ID

**Example:**
```http
GET /api/Languages/by-reference?tableName=Property&refId=123
```

**Response:** `LanguageDto`
```json
{
  "ka": "ქართული ტექსტი",
  "en": "English text",
  "ru": "Русский текст"
}
```

### Cities and Regions

Manage geographical locations for properties and places.

#### Cities

**Get All Cities**
```http
GET /api/City
```

**Get City by ID**
```http
GET /api/City/{id}
```

**Create City**
```http
POST /api/City
```

**Example Request:**
```json
{
  "name": "Batumi",
  "regionId": 2,
  "language": {
    "ka": "ბათუმი",
    "en": "Batumi", 
    "ru": "Батуми"
  }
}
```

**Update City**
```http
PUT /api/City/{id}
```

**Delete City**
```http
DELETE /api/City/{id}
```

#### Regions

**Get All Regions**
```http
GET /api/Region?numberOf={count}
```

**Get Region by ID**
```http
GET /api/Region/{id}
```

**Create Region**
```http
POST /api/Region
```

**Example Request:**
```json
{
  "name": "Adjara",
  "language": {
    "ka": "აჭარა",
    "en": "Adjara",
    "ru": "Аджария"
  }
}
```

### Places

Manage tourist attractions and points of interest.

#### Get Places

```http
GET /api/Places?category={category}&search={term}&cityId={id}&regionId={id}
```

**Query Parameters:**
- `category` (string, optional): Filter by place category
- `search` (string, optional): Search term
- `cityId` (integer, optional): Filter by city
- `regionId` (integer, optional): Filter by region

#### Get Place Details

```http
GET /api/Places/{id}
```

**Description:** Returns place details including 360° virtual tour and nearby properties.

**Response:** `PlaceDetailsDto`

#### Create Place

```http
POST /api/Places
```

**Example Request:**
```json
{
  "name": "Narikala Fortress",
  "kuulaEmbedCode": "<iframe src='https://kuula.co/narikala'></iframe>",
  "cityId": 1,
  "slug": "narikala-fortress",
  "mapLink": "https://maps.google.com/narikala",
  "language": {
    "ka": "ნარიყალის ციხე",
    "en": "Narikala Fortress",
    "ru": "Крепость Нарикала"
  }
}
```

### Calendar Integration

Manage calendar integration for booking availability.

#### Get Calendar Events

```http
GET /api/ICalendar/events?icalUrl={url}
```

**Description:** Retrieves events from an iCalendar URL for availability checking.

**Query Parameters:**
- `icalUrl` (string, required): The iCalendar URL to fetch events from

#### Manage iCalendar Properties

**Get All iCalendar Properties**
```http
GET /api/ICalendarProperty
```

**Create iCalendar Property**
```http
POST /api/ICalendarProperty
```

**Example Request:**
```json
{
  "ownerName": "Property Owner Name",
  "iCalLink": "https://calendar.google.com/calendar/ical/property123.ics"
}
```

### Currency Exchange

#### Convert Currency

```http
GET /api/ExchangeRate/convert?fromCurrency={from}&toCurrency={to}&amount={amount}
```

**Description:** Converts currency amounts for pricing display.

**Query Parameters:**
- `fromCurrency` (string, required): Source currency code (e.g., "USD")
- `toCurrency` (string, required): Target currency code (e.g., "GEL")
- `amount` (number, required): Amount to convert

**Example:**
```http
GET /api/ExchangeRate/convert?fromCurrency=USD&toCurrency=GEL&amount=100
```

### Notifications

#### Send Welcome Email

```http
POST /api/Notifications/welcome?email={email}
```

**Query Parameters:**
- `email` (string, required): Email address to send welcome message

#### Submit Contact Request

```http
POST /api/Notifications
```

**Description:** Processes contact form submissions.

**Request Body:** `ContactRequestDto`
```json
{
  "name": "John Doe",
  "email": "john.doe@example.com",
  "phone": "+1234567890",
  "message": "I'm interested in your Mountain View Resort property. Could you provide more information about availability in July?"
}
```

### Property Types

#### Get All Types

```http
GET /api/Types
```

#### Create Type

```http
POST /api/Types
```

**Example Request:**
```json
{
  "name": "Villa",
  "image": "https://storage.example.com/villa-icon.jpg"
}
```

### Blog

#### Get All Blog Posts

```http
GET /api/Blog
```

#### Get Blog Post

```http
GET /api/Blog/{id}
```

#### Create Blog Post

```http
POST /api/Blog
```

**Example Request:**
```json
{
  "title": "Best Places to Visit in Georgia",
  "slug": "best-places-georgia",
  "thumbnail": "https://storage.example.com/georgia-blog.jpg",
  "mapLink": "https://maps.google.com/georgia-places",
  "description": {
    "ka": "საქართველოში სანახავი საუკეთესო ადგილები",
    "en": "Best places to visit in Georgia",
    "ru": "Лучшие места для посещения в Грузии"
  }
}
```

### SQL Operations

#### Execute SQL Query

```http
POST /api/Sql
```

**Description:** Executes custom SQL queries (admin only).

**Request Body:** SQL query string

⚠️ **Security Warning:** This endpoint should be heavily restricted and only available to authorized administrators.

## Error Handling

The API uses standard HTTP status codes and returns error details in RFC 7807 `ProblemDetails` format for consistent error handling.

### Error Response Format

```json
{
  "type": "https://example.com/validation-error",
  "title": "Validation failed",
  "status": 400,
  "detail": "The Name field is required",
  "instance": "/api/Properties"
}
```

### Common Status Codes

| Code | Description |
|------|-------------|
| `200` | Success |
| `201` | Created |
| `204` | No Content |
| `400` | Bad Request - Invalid input data |
| `404` | Not Found - Resource doesn't exist |
| `500` | Internal Server Error |

## Data Models

### Core DTOs

#### PropertyCardDto
Basic property information for listings and search results.

```json
{
  "id": 1,
  "name": "Property Name",
  "slug": "property-slug",
  "city": "City Name",
  "minPrice": 100,
  "maxPrice": 500,
  "thumbnail": "https://...",
  "rating": "4.5",
  "type": "Apartment",
  "orderIndex": 1,
  "createdAt": "2024-01-01T00:00:00Z"
}
```

#### PropertyDto
Complete property details with all related information.

#### RoomDto
Individual room information within a property.

```json
{
  "id": 1,
  "name": "Deluxe Room",
  "sqft": 300,
  "amountOfPeople": 2,
  "bedrooms": 1,
  "bathrooms": 1,
  "price": 200,
  "kuulaEmbedCode": "<iframe...>",
  "iCalLink": "https://calendar..."
}
```

#### LanguageDto
Multi-language content structure.

```json
{
  "ka": "ქართული ტექსტი",
  "en": "English text", 
  "ru": "Русский текст"
}
```

#### StorageDto
File and image metadata.

```json
{
  "id": 1,
  "name": "image.jpg",
  "link": "https://storage.../image.jpg",
  "refId": 123,
  "tableName": "Property",
  "isThumbnail": true
}
```

## Usage Examples

### Complete Property Creation Workflow

#### Step 1: Create the Property

```http
POST /api/Properties
Content-Type: application/json

{
  "name": "Seaside Villa",
  "slug": "seaside-villa-batumi",
  "cityId": 2,
  "typeId": 3,
  "hostName": "Maria Georgieva",
  "hostNumber": "+995555987654",
  "language": {
    "ka": "ზღვისპირა ვილა ბათუმში",
    "en": "Seaside Villa in Batumi",
    "ru": "Вилла у моря в Батуми"
  },
  "rooms": [
    {
      "name": "Ocean View Suite",
      "sqft": 450,
      "amountOfPeople": 4,
      "bedrooms": 2,
      "bathrooms": 2,
      "price": 300
    }
  ]
}
```

#### Step 2: Upload Property Images

```bash
# Upload main thumbnail
curl -X POST "/api/Storage/upload" \
  -F "File=@villa-exterior.jpg" \
  -F "TableName=Property" \
  -F "RefId=newPropertyId" \
  -F "IsThumbnail=true"

# Upload additional images
curl -X POST "/api/Storage/upload" \
  -F "File=@villa-interior.jpg" \
  -F "TableName=Property" \
  -F "RefId=newPropertyId" \
  -F "IsThumbnail=false"
```

#### Step 3: Add Additional Language Content

```http
POST /api/Languages
Content-Type: application/json

{
  "ka": "მდიდარი ზღვისპირა ვილა ბათუმში, რომელიც იდეალურია ოჯახური დასვენებისთვის. ვილას აქვს შესანიშნავი ზღვის ხედი და ყველა საჭიro კომფორტი.",
  "en": "Luxurious seaside villa in Batumi, perfect for family vacation. The villa features stunning sea views and all necessary amenities.",
  "ru": "Роскошная вилла у моря в Батуми, идеальная для семейного отдыха. Вилла имеет потрясающий вид на море и все необходимые удобства.",
  "tableName": "Property",
  "refId": newPropertyId
}
```

### Search and Filter Properties

```javascript
// Get all properties in Tbilisi
const tbilisiProperties = await fetch('/api/Properties')
  .then(response => response.json())
  .then(properties => properties.filter(p => p.city === 'Tbilisi'));

// Get top 10 properties
const topProperties = await fetch('/api/Properties?numberOf=10')
  .then(response => response.json());
```

### Multi-language Content Management

```javascript
// Get property details with language
const propertyId = 123;
const property = await fetch(`/api/Properties/${propertyId}`)
  .then(response => response.json());

// Get specific language content
const georgianContent = await fetch(`/api/Languages/by-reference?tableName=Property&refId=${propertyId}`)
  .then(response => response.json());

console.log(georgianContent.ka); // Georgian description
console.log(georgianContent.en); // English description
console.log(georgianContent.ru); // Russian description
```

### File Upload with Progress

```javascript
function uploadPropertyImage(file, propertyId, isThumbnail = false) {
  const formData = new FormData();
  formData.append('File', file);
  formData.append('TableName', 'Property');
  formData.append('RefId', propertyId);
  formData.append('IsThumbnail', isThumbnail.toString());

  return fetch('/api/Storage/upload', {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(result => {
    console.log('File uploaded:', result.url);
    return result;
  })
  .catch(error => {
    console.error('Upload failed:', error);
    throw error;
  });
}

// Usage
uploadPropertyImage(fileInput.files[0], 123, true)
  .then(result => console.log('Thumbnail uploaded:', result.url));
```

## Rate Limits and Best Practices

### Best Practices

1. **File Uploads**: 
   - Always specify the correct `TableName` and `RefId`
   - Use appropriate image formats (JPG, PNG, WebP)
   - Compress images before upload for better performance

2. **Language Content**:
   - Provide content in all three languages when possible
   - Use consistent terminology across languages
   - Keep `tableName` and `refId` accurate for proper associations

3. **Property Management**:
   - Use meaningful slugs for SEO
   - Include virtual tour codes for better user experience
   - Set appropriate pricing for all rooms

4. **Error Handling**:
   - Always check response status codes
   - Handle `ProblemDetails` error responses appropriately
   - Implement retry logic for temporary failures

### Integration Checklist

- [ ] Authentication implemented
- [ ] Error handling for all endpoints
- [ ] File upload functionality tested
- [ ] Multi-language content workflow established
- [ ] Virtual tour integration configured
- [ ] Calendar sync operational
- [ ] Currency conversion working
- [ ] Notification system tested

---

**Document Version:** 1.0  
**Last Updated:** January 2024  
**Contact:** contact@resorter360.com

*This documentation is generated from the OpenAPI 3.0.1 specification and should be updated when the API changes.*